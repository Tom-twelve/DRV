/**
 ******************************************************************************
 * @file		tle5012.h
 * @author		WrathWings
 * @version 	V1.0
 * @date		2018.1.17
 * @brief		The header file of tle5012.c
 ******************************************************************************
 * @attention
 *
 ******************************************************************************
 */
 /* Define to prevent recursive inclusion -------------------------------------*/
#ifndef __TLE5012_H
#define __TLE5012_H

/* Private includes ----------------------------------------------------------*/
/* CODE BEGIN Includes */
#include <stdint.h>
#include <stdlib.h>
#include "gpio.h"
#include "tim.h"
#include "spi.h"
#include "MotorConfig.h"
#include "AngleTable.h"
#include "util.h"
#include "foc.h"
/* CODE END Includes */

/* Private define ------------------------------------------------------------*/
/* USER CODE BEGIN PD */
#define SPI_TX_ON           GPIOB->MODER &= 0xFFFFF3FF; GPIOB->MODER |= 0x00000800	// PB5--MOSI复用
#define SPI_TX_OFF          GPIOB->MODER &= 0xFFFFF3FF; GPIOB->MODER |= 0x00000000	//PB5--复位(输入模式)

#define	TLE5012_UpdateTime_0		0.0000213f	//(us)	
#define	TLE5012_UpdateTime_1		0.0000427f	//(us)	
#define	TLE5012_UpdateTime_2		0.0000853f	//(us)	
#define	TLE5012_UpdateTime_3		0.0001706f	//(us)	
	
#define	TLE5012_SPI1_ChipSelect				LL_GPIO_ResetOutputPin(Encoder_SPI1_NSS_GPIO_Port, Encoder_SPI1_NSS_Pin)
#define	TLE5012_SPI1_ChipDiselect			LL_GPIO_SetOutputPin(Encoder_SPI1_NSS_GPIO_Port, Encoder_SPI1_NSS_Pin)

#define TLE5012_Command_ReadCurrentValue_AngleValue		0x8021	
#define TLE5012_Command_ReadUpdatedValue_AngleValue		0x8421	

#define TLE5012_Command_ReadCurrentValue_AngleSpeed 	0x8031	
#define TLE5012_Command_ReadUpdatedValue_AngleSpeed		0x8431	

#define TimeOut		200
/* USER CODE END PD */

/* Private typedef -----------------------------------------------------------*/
/* USER CODE BEGIN PTD */
struct Encoder_t
{
	uint16_t MechanicalAngle_15bit;
	int16_t MechanicalAngleSpeed_Encoder_15bit;
	float MechanicalAngleSpeed_Encoder;
	float MechanicalAngle;
	float MechanicalAngleSpeed;
	float AverageMechanicalAngleSpeed;
	float ElectricalAngle;
	float ElectricalAngleSpeed;
	float AverageElectricalAngleSpeed;
};

/* USER CODE END PTD */
/* Private function prototypes -----------------------------------------------*/
/* USER CODE BEGIN PFP */
void GetPositionImformation(void);
void GetMechanicalAngle_15bit(void);
void GetMechanicalAngle(void);
void GetMechanicalAngleSpeed(void);
void CalculateElectricalAngle(void);
void GetElectricalAngleSpeed(void);
void GetAverageElectricalAngleSpeed(void);
void GetAverageMechanicalAngleSpeed(void);
void GetMechanicalAngleSpeed_Encoder_15bit(void);
void GetMechanicalAngleSpeed_Encoder(void);
uint16_t TLE5012_ReadRegister(uint16_t command);

/* USER CODE END PFP */

#endif

/************************ (C) COPYRIGHT ACTION *****END OF FILE****/
